<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Daily Roo</title>
<style>
  :root{
    --fg:#ecf1f6; --bg:#0d0f12; --chip:rgba(20,20,24,.72);
    --accent:#87f59f; --bad:#ff6b6b; --grid-gap:.5rem;
    --tile-bg:#e8eef5; --tile-fg:#0e1116; --tile-radius:22%;
    --calm-sat:1.05; --calm-ctr:1.05;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family:system-ui,-apple-system,Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  /* soft animated gradient (very slow to stay sensory-friendly) */
  body{
    background:
      radial-gradient(1200px 800px at 20% 10%, rgba(160,110,255,.14), transparent 65%),
      radial-gradient(900px 700px at 80% 30%, rgba(255,90,140,.10), transparent 60%),
      linear-gradient(135deg, #0f1220, #0d1016 58%, #0c0f14);
    animation: drift 60s ease-in-out infinite alternate;
    filter: saturate(var(--calm-sat)) contrast(var(--calm-ctr));
  }
  @keyframes drift{to{background-position: 20% 10%, 85% 40%, 100% 100%}}

  header{position:fixed;left:0;right:0;top:0;display:flex;gap:.5rem .6rem;flex-wrap:wrap;
    align-items:center;padding:.6rem .7rem;z-index:30;pointer-events:none}
  .chip{pointer-events:auto;background:var(--chip);border:1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(8px); border-radius:14px; padding:.38rem .65rem;
    display:flex; gap:.45rem; align-items:center; font-weight:700; white-space:nowrap}
  .btn{cursor:pointer; color:#fff}
  .pill{border-radius:999px; padding:.35rem .75rem}
  .hide{display:none!important}

  #wrap{position:fixed;inset:0;display:flex;flex-direction:column}
  #stage{position:fixed; inset:80px 0 120px 0; display:flex; align-items:center; justify-content:center}
  #grid{display:grid; gap:var(--grid-gap); touch-action:none}
  .cell{
    background:var(--tile-bg); color:var(--tile-fg); border-radius:var(--tile-radius);
    box-shadow: inset 0 -2px 0 rgba(0,0,0,.12);
    display:flex; align-items:center; justify-content:center;
    font-weight:800; font-size:1.15rem; letter-spacing:.02em; position:relative;
    user-select:none;
  }
  /* bigger hit area w/o changing layout */
  .cell::before{content:""; position:absolute; inset:-8px}

  .cell.sel{outline:3px solid #5fb5ff; outline-offset:2px; background:#f5f9ff}
  .cell.found{background:#d7ffe4}

  /* bottom panel */
  #bottom{position:fixed;left:0;right:0;bottom:0;z-index:20;
    padding:.6rem .7rem env(safe-area-inset-bottom,0px);
    background:linear-gradient(to top, rgba(10,10,14,.95), rgba(10,10,30,.7) 50%, transparent)}
  #wordRow{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
  .target{background:#1c222b;border:1px solid rgba(255,255,255,.12);
    border-radius:.7rem;padding:.42rem .6rem;font-weight:800;letter-spacing:.08em}
  .done{opacity:.5}

  #banner{position:fixed;left:50%;top:54%;transform:translate(-50%,-50%);
    padding:.7rem 1rem;border-radius:12px;font-weight:900;font-size:1.05rem;
    background:rgba(20,22,26,.86); border:1px solid rgba(255,255,255,.12); display:none}
  #banner.win{color:var(--accent)} #banner.lose{color:var(--bad)}

  /* CAMO THEME (sensory-respectful: sharp, no flashing) */
  .camo .cell{
    background:
      linear-gradient(15deg, rgba(0,0,0,.06), rgba(255,255,255,.04)) border-box,
      url('https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=600&auto=format&fit=crop') center/180% no-repeat;
    color:#fff; text-shadow:0 1px 1px rgba(0,0,0,.55);
    border:1px solid rgba(255,255,255,.10);
  }
  /* SUEDE / FELT ALT (toggle body.className = 'suede') */
  .suede .cell{
    background:
      radial-gradient(120% 120% at 30% 20%, #3e4550, #252b34 60%, #1e232a 100%);
    box-shadow:
      inset 0 1px 2px rgba(255,255,255,.08),
      inset 0 -2px 4px rgba(0,0,0,.5);
    color:#f2f4f7;
  }
</style>
</head>
<body class="camo"><!-- swap to 'suede' to try another look -->
<div id="wrap">
  <header>
    <div id="btnStart" class="chip btn">‚ñ∂ Daily Roo</div>
    <div id="timeChip" class="chip">‚è± <b id="hudTime">‚Äî</b> s</div>
    <div class="chip pill">Streak ‚≠ê <b id="streak">0</b></div>
    <div class="chip">Theme: <b id="themeName">Camo</b></div>
    <div class="chip">Word: <b id="wordLen">‚Äî</b> letters</div>
  </header>

  <div id="stage">
    <div id="grid" aria-label="letter grid"></div>
  </div>

  <div id="bottom">
    <div id="wordRow">
      <div class="chip">Find:</div>
      <div id="target" class="target">‚Äî</div>
      <div id="lbHint" class="chip" title="Leaderboard placeholder">üèÜ Leaderboard (coming)</div>
    </div>
  </div>

  <div id="banner"></div>
</div>

<script>
/* ================== helpers & state ================== */
const $ = s => document.querySelector(s);
const gridEl = $('#grid'), targetEl = $('#target'), hudTime = $('#hudTime'),
      wordLenEl = $('#wordLen'), banner = $('#banner'), themeName = $('#themeName');

const DIFF = { rows:14, cols:14, timer:120 }; // hard/expert board
const WORDS = [
  // keep the set sensory-neutral, single nouns/objects (swap to your curated list later)
  'MARIGOLD','KANGAROO','RAINFOREST','NOTEBOOK','SATELLITE','UMBRELLA','PINEAPPLE','LANTERN','TELESCOPE'
];

const S = {
  rows:DIFF.rows, cols:DIFF.cols, grid:[], placed:[],
  target:'', targetIdxs:[], time:DIFF.timer, running:false,
  dragging:false, startIdx:null, selPath:[],
};

/* ================== grid / placement ================== */
const idx = (r,c)=> r*S.cols + c;
const inb = (r,c)=> r>=0 && c>=0 && r<S.rows && c<S.cols;
function rcFromIdx(id){ return [(id/S.cols)|0, id%S.cols]; }
function allowedDirs(){ return [[0,1],[0,-1],[1,0],[-1,0],[1,1],[-1,-1],[1,-1],[-1,1]]; }

function buildEmpty(){ S.grid = Array(S.rows*S.cols).fill(''); }
function fillRandom(){
  const BAG = "EEEEEEEEEEEEEEEAAAAAAAIIIIIIIOOOOOONNNNRRRRRSSSSTTTTTDLLLLUGGBBCCMMPPFFHHVVWWYKJXQZ";
  for (let i=0;i<S.grid.length;i++) if (!S.grid[i]) S.grid[i] = BAG[(Math.random()*BAG.length)|0];
}

function tryPlaceWord(W){
  W = W.toUpperCase();
  const dirs = allowedDirs();
  for (let a=0; a<400; a++){
    const dir = dirs[(Math.random()*dirs.length)|0];
    const len = W.length;
    const r0 = (Math.random()*S.rows)|0, c0 = (Math.random()*S.cols)|0;
    const r1 = r0 + dir[0]*(len-1), c1 = c0 + dir[1]*(len-1);
    if (!inb(r1,c1)) continue;
    let ok=true, path=[];
    for (let k=0;k<len;k++){
      const r=r0+dir[0]*k, c=c0+dir[1]*k, id=idx(r,c);
      const ch=S.grid[id]; if (ch && ch!==W[k]) { ok=false; break; }
      path.push(id);
    }
    if (!ok) continue;
    // (no reverse on Daily Roo; keep it tough-but-fair)
    for (let k=0;k<len;k++) S.grid[path[k]] = W[k];
    S.placed.push({text:W, path});
    S.target = W; S.targetIdxs = path;
    return true;
  }
  return false;
}

function renderGrid(){
  gridEl.innerHTML='';
  gridEl.style.gridTemplateColumns = `repeat(${S.cols}, 1fr)`;
  const size = Math.min(innerWidth - 20, (innerHeight - 220));
  gridEl.style.width = Math.max(280, size) + 'px';
  gridEl.style.height = Math.max(280, size) + 'px';
  for (let i=0;i<S.grid.length;i++){
    const d = document.createElement('div');
    d.className = 'cell'; d.textContent = S.grid[i]; d.dataset.idx = i;
    gridEl.appendChild(d);
  }
}

/* ================== selection ================== */
function dirOf(a,b){
  const [ar,ac]=rcFromIdx(a), [br,bc]=rcFromIdx(b);
  const dr=Math.sign(br-ar), dc=Math.sign(bc-ac);
  if(dr===0&&dc===0) return null;
  if(dr!==0&&dc!==0 && Math.abs(br-ar)!==Math.abs(bc-ac)) return null;
  return [dr,dc];
}
function cellsBetween(a,b){
  const d=dirOf(a,b); if(!d) return null;
  const [ar,ac]=rcFromIdx(a), [br,bc]=rcFromIdx(b);
  const n=Math.max(Math.abs(br-ar),Math.abs(bc-ac))+1, out=[];
  for(let k=0;k<n;k++){ const r=ar+d[0]*k, c=ac+d[1]*k; out.push(idx(r,c)); }
  return out;
}
function setSel(on,list){ for(const id of list){ gridEl.children[id]?.classList.toggle('sel',on); } }
function wordFrom(list){ return list.map(i=>S.grid[i]).join(''); }

gridEl.addEventListener('pointerdown', e=>{
  if (!S.running) return;
  const el = e.target.closest('.cell'); if (!el) return;
  S.dragging=true; S.selPath.length=0; S.startIdx=+el.dataset.idx;
  S.selPath=[S.startIdx]; setSel(true,S.selPath);
  gridEl.setPointerCapture?.(e.pointerId); e.preventDefault();
},{passive:false});
gridEl.addEventListener('pointermove', e=>{
  if (!S.dragging || !S.running) return;
  const el = document.elementFromPoint(e.clientX,e.clientY)?.closest('.cell'); if(!el) return;
  const id = +el.dataset.idx; if (id===S.startIdx) return;
  const seq = cellsBetween(S.startIdx, id); if (!seq) return;
  setSel(false,S.selPath); S.selPath=seq; setSel(true,S.selPath);
  e.preventDefault();
},{passive:false});
addEventListener('pointerup', ()=>{
  if(!S.dragging) return; S.dragging=false;
  if(!S.selPath.length) return;
  const fwd = wordFrom(S.selPath), rev = wordFrom([...S.selPath].reverse());
  if (fwd===S.target || rev===S.target){
    // mark found, stop timer, show banner
    for (const id of S.targetIdxs){ const c = gridEl.children[id]; if (c){ c.classList.remove('sel'); c.classList.add('found'); } }
    S.running=false;
    showBanner(`WINNER! Time left +${Math.ceil(S.time)}s`, true);
    // TODO: submit score ‚Ü¶ leaderboard
  } else {
    setSel(false,S.selPath);
  }
  S.selPath.length=0;
});

/* ================== timer ================== */
let lastTick=0;
function tick(now){
  if (!now) now = performance.now();
  const dt = lastTick ? (now - lastTick)/1000 : 0; lastTick = now;
  if (S.running){
    S.time -= dt; if (S.time <= 0){ S.time=0; S.running=false; showBanner('Time up!', false); }
    hudTime.textContent = Math.ceil(S.time);
  } else {
    hudTime.textContent = '‚Äî';
  }
  requestAnimationFrame(tick);
}

/* ================== start / build ================== */
function buildDaily(theme='camo'){
  document.body.className = theme; // 'camo' | 'suede' | add more later
  themeName.textContent = (theme==='camo' ? 'Camo' : theme.charAt(0).toUpperCase()+theme.slice(1));

  S.time = DIFF.timer; S.running = false; S.placed.length=0; S.target=''; S.targetIdxs=[];
  buildEmpty();

  // choose a single target word; you can rotate daily via date hash
  const W = WORDS[(Math.random()*WORDS.length)|0];
  if (!tryPlaceWord(W)) { buildDaily(theme); return; } // rare retry if placement fails

  fillRandom(); renderGrid();

  // HUD
  targetEl.textContent = W;  // (you may hide this later if you want ‚Äúblind‚Äù)
  wordLenEl.textContent = W.length;
}

function showBanner(msg, ok){
  banner.textContent = msg;
  banner.className = ok ? 'win' : 'lose';
  banner.style.display = 'block';
  setTimeout(()=> banner.style.display='none', 2600);
  // (optional) trigger confetti here
}

/* start button */
$('#btnStart').onclick = ()=>{
  buildDaily('camo'); // change theme here dynamically if you like
  S.running = true;
  banner.style.display = 'none';
};

/* boot */
buildDaily('camo'); // board visible but timer idle
requestAnimationFrame(tick);
</script>
</body>
</html>
