<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Daily Roo ‚Äî solo, funny words, skins, splash</title>

<style>
  :root{
    --fg:#e9eef4; --bg:#0f1011; --chip:rgba(20,20,22,.72); --sab:env(safe-area-inset-bottom,0px);
    --accent:#7aa7ff; --ok:#87f59f; --bad:#ff6b6b;

    /* Tile skin knobs */
    --tile-skin:url("https://images.unsplash.com/photo-1600607687920-4ce9a5c1f4c1?q=80&w=600&auto=format&fit=crop"); /* sample felt */
    --tile-opacity:0.95;      /* 0.75‚Äì1.0 looks nice */
    --tile-shadow:0 6px 16px rgba(0,0,0,.22);
    --tile-size:48px;         /* base tile size, will be scaled */
    --hit-grow:10px;          /* extra tap area */
  }
  html,body{margin:0;height:100%;color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;}
  html, body {
    background: linear-gradient(-45deg in oklch, red, orange, green, blue, indigo, violet);
    background-size: 600% 600%; animation: driftGradient 120s ease infinite;
  }
  @keyframes driftGradient { 0%{background-position:0% 0%} 50%{background-position:100% 100%} 100%{background-position:0% 0%} }

  #wrap{position:fixed;inset:0;display:flex;flex-direction:column;}
  header{position:fixed;left:0;right:0;top:0;display:flex;gap:.5rem .6rem;flex-wrap:wrap;
    align-items:center;padding:.55rem .7rem;z-index:20;pointer-events:none}
  .chip{pointer-events:auto;background:var(--chip);border:1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(8px); border-radius:14px; padding:.35rem .6rem;
    display:flex; gap:.45rem; align-items:center; font-weight:700; white-space:nowrap}
  .btn{cursor:pointer; color:#fff}
  .pill{border-radius:999px; padding:.35rem .75rem}

  /* Top (grid) */
  #top{position:fixed;left:0;right:0;top:56px;bottom:160px;display:flex;align-items:center;justify-content:center}
  #gridWrap{ display:flex; align-items:center; justify-content:center; }
  #grid{display:grid;gap:.55rem;touch-action:none;place-content:center}
  .cell{
    width:clamp(34px, 8vw, 52px); height:clamp(34px, 8vw, 52px);
    border-radius:22%; display:flex; align-items:center; justify-content:center;
    font-weight:900; font-size:clamp(16px, 4vw, 22px); letter-spacing:.02em; position:relative;
    color:#0e1116; background:#e8eef5;
    box-shadow:var(--tile-shadow);
    /* skin */
    background-image:var(--tile-skin);
    background-size:140px 140px; background-repeat:repeat; background-blend-mode:multiply;
    opacity:var(--tile-opacity);
  }
  .cell::before{ content:""; position:absolute; inset:calc(var(--hit-grow) * -1); } /* bigger hit */
  .cell.sel{outline:3px solid #5fb5ff; outline-offset:2px; filter:brightness(1.1)}
  .cell.found{ background:rgba(215,255,228,.88); opacity:1; }
  .cell.hint{ outline:3px dashed #49e68b; animation: hintPulse 1.1s ease-in-out 2; }
  @keyframes hintPulse{0%{filter:none}50%{filter:brightness(1.5)}100%{filter:none}}

  /* Bottom words list */
  #bottom{position:fixed;left:0;right:0;bottom:0;z-index:15;
    padding:.6rem .7rem calc(.6rem + var(--sab));
    background:linear-gradient(to top, rgba(10,10,20,.92), rgba(10,10,50,.6) 50%, transparent)}
  #words{display:grid; grid-template-columns:repeat(2, minmax(140px,1fr)); gap:.4rem .6rem}
  .w{background:#1c222b;border:1px solid rgba(255,255,255,.12); border-radius:.7rem;
     padding:.42rem .6rem; font-weight:800; letter-spacing:.06em; display:flex; gap:.4rem; align-items:center}
  .w.done{opacity:.55}
  .circ{display:inline-flex;align-items:center;justify-content:center;width:1.35em;height:1.35em;border-radius:999px;border:2px solid var(--accent);font-weight:900}

  /* Splash at the end */
  #splash{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background:rgba(0,0,0,.55); backdrop-filter:blur(6px); z-index:40;
  }
  #splash .panel{
    width:min(92vw,560px);
    background:#121318; color:var(--fg); border:1px solid rgba(255,255,255,.14);
    border-radius:16px; padding:16px 16px 14px; box-shadow:0 16px 48px rgba(0,0,0,.45);
  }
  #splash h2{ margin:.2rem 0 .5rem; font-size:1.35rem }
  #splash .meaning{ opacity:.9; line-height:1.45; margin:.35rem 0 .7rem }
  #splash .row{ display:flex; gap:.5rem; flex-wrap:wrap; justify-content:flex-end }
  #splash a, #splash button{ all:unset; cursor:pointer }
  #splash .btnX{
    background:#273141; border:1px solid rgba(255,255,255,.18); border-radius:10px;
    padding:.55rem .85rem; font-weight:800;
  }

  .hide{display:none!important}
</style>
</head>
<body>
<div id="wrap">
  <header>
    <div id="btnStart" class="chip btn">‚ñ∂ Start</div>
    <div id="btnCfg" class="chip btn">‚öôÔ∏è Settings</div>
    <div id="hintBtn" class="chip btn">üí° Hint</div>
    <div id="timeChip" class="chip">‚è± <b id="hudTime">‚Äî</b> s</div>
    <div id="targetChip" class="chip">üéØ <b id="hudTarget">‚Äî</b></div>
  </header>

  <div id="top">
    <div id="gridWrap" aria-label="letter grid warp">
      <div id="grid" aria-label="letter grid">
      </div>
    </div>
  </div>

  <div id="bottom">
    <div id="words"></div>
  </div>
</div>

<!-- Finish Splash -->
<div id="splash" role="dialog" aria-modal="true">
  <div class="panel">
    <h2 id="spWord">ROOSEY WORD</h2>
    <div id="spMeaning" class="meaning">What we think it means‚Ä¶</div>
    <div class="row">
      <a id="spDonate" class="btnX" href="#" target="_blank" rel="noopener">‚ô• Donate</a>
      <button id="spContinue" class="btnX">Continue</button>
    </div>
  </div>
</div>

<script>
/* =============== helpers =============== */
const $ = s => document.querySelector(s);
const hudTime = $('#hudTime'), hudTarget = $('#hudTarget');
const gridEl = $('#grid'), wordsEl=$('#words'), hintBtn=$('#hintBtn');
const buzz = pat => ('vibrate' in navigator) && navigator.vibrate(pat);

function rand(n){ return (Math.random()*n)|0; }

/* =============== funny words & meanings =============== */
// You can mix plain strings and objects {display, target, bag?, meaning?, donate?}
const WORDS = [
  { display: 'herer',      target: 'HERER', meaning: 'Roosey-ism, pronounced ‚Äúher-ERR‚Äù. Meaning TBD üòÑ' },
  { display: 'da paytsa üçï', target: 'DA PAYTSA', meaning: '‚ÄúThe pizza.‚Äù A beloved snack!', donate: 'https://gofund.me/your-link' },
  { display: 'dadideedee', target: 'DADIDEEDEE', bag: 'DAIE', meaning: 'An all-time classic Roosey song-word.' },
  'KANGAROO', 'MARIGOLD', 'NOTEBOOK'
];

// Optional ‚Äúskins‚Äù for board/tiles (repeat patterns or photos). One gets picked per run.
const SKINS = [
  // felt/suede vibes (royalty-free examples)
  "https://images.unsplash.com/photo-1600607687920-4ce9a5c1f4c1?q=80&w=600&auto=format&fit=crop",
  "https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=600&auto=format&fit=crop",
  "https://images.unsplash.com/photo-1534088568595-a066f410bcda?q=80&w=600&auto=format&fit=crop",
  // playful patterns (tileable-ish)
  "https://images.unsplash.com/photo-1526256262350-7da7584cf5eb?q=80&w=600&auto=format&fit=crop",
];

// Map for meanings when using plain string entries
const MEANINGS = {
  KANGAROO: 'Our favorite marsupial and unofficial mascot.',
  MARIGOLD: 'A cheerful flower (Calendula/Tagetes).',
  NOTEBOOK: 'Where big ideas start.',
};

/* =============== sanitize & normalize =============== */
function toGridTarget(s){
  return s.normalize('NFD')
    .replace(/[\u0300-\u036f]/g,'') // accents
    .toUpperCase().replace(/[^A-Z]/g,'');
}
function normalizeWord(w){
  if (typeof w === 'string'){
    const tgt = toGridTarget(w);
    return { display:w, target:tgt, meaning: MEANINGS[tgt] || '' };
  }
  const display = w.display ?? (w.target ?? '');
  const target = toGridTarget(w.target ?? display);
  return { display, target, bag:w.bag, meaning:w.meaning || MEANINGS[target] || '', donate:w.donate || '' };
}

/* =============== state =============== */
const S = {
  rows:11, cols:11,
  grid:[], placed:[], found:new Set(),
  dragging:false, startIdx:null, selPath:[],
  hintLock:false, time:0, running:false,
  current:null, // {display,target,bag,meaning,donate}
};

/* =============== layout =============== */
function layout(){
  // grid size adapt: make it square-ish
  const top = document.getElementById('top');
  const head = document.querySelector('header');
  const bottomH = 160;
  const h = Math.max(260, innerHeight - head.offsetHeight - bottomH - 10);
  top.style.top = head.offsetHeight + 'px';
  top.style.bottom = bottomH + 'px';

  gridEl.style.gridTemplateColumns = `repeat(${S.cols}, 1fr)`;
}
addEventListener('resize', layout);
visualViewport?.addEventListener('resize', layout);

/* =============== board building =============== */
const idx=(r,c)=> r*S.cols+c;
const inb=(r,c)=> r>=0 && c>=0 && r<S.rows && c<S.cols;

function buildEmpty(){ S.grid = Array(S.rows*S.cols).fill(''); S.placed.length=0; }

function allowedDirs(){ return [[0,1],[0,-1],[1,0],[-1,0],[1,1],[-1,-1],[1,-1],[-1,1]]; }

function tryPlaceWord(W){
  const dirs=allowedDirs();
  for (let attempt=0; attempt<300; attempt++){
    const dir=dirs[rand(dirs.length)], len=W.length;
    const r0=rand(S.rows), c0=rand(S.cols);
    const r1=r0+dir[0]*(len-1), c1=c0+dir[1]*(len-1);
    if (!inb(r1,c1)) continue;
    let ok=true, path=[];
    for(let k=0;k<len;k++){
      const r=r0+dir[0]*k, c=c0+dir[1]*k, id=idx(r,c);
      const ch=S.grid[id]; if (ch && ch!==W[k]){ ok=false; break; }
      path.push(id);
    }
    if(!ok) continue;
    // (optional) reverse ~35%
    const rev = Math.random()<.35;
    const use = rev ? [...W].reverse().join('') : W;
    for(let k=0;k<len;k++){ S.grid[path[k]] = use[k]; }
    S.placed.push({text:W, path});
    return true;
  }
  return false;
}

function fillRandom(customBag){
  const BAG = (customBag && customBag.replace(/[^A-Z]/gi,'')) ||
              "EEEEEEEEEEEEEEEAAAAAAAIIIIIIIOOOOOONNNNRRRRRSSSSTTTTTDLLLLUGGBBCCMMPPFFHHVVWWYKJXQZ";
  const bagU = BAG.toUpperCase();
  for(let i=0;i<S.grid.length;i++) if(!S.grid[i]) S.grid[i]=bagU[rand(bagU.length)];
}

/* =============== render =============== */
function renderGrid(){
  gridEl.innerHTML='';
  for (let i=0;i<S.grid.length;i++){
    const d=document.createElement('div');
    d.className='cell';
    d.textContent=S.grid[i];
    d.dataset.idx=i;
    gridEl.appendChild(d);
  }
  gridEl.style.gridTemplateColumns = `repeat(${S.cols}, 1fr)`;
}
function renderWordList(){
  // Daily Roo is 1 target word ‚Üí show decorative row with circled letters (optional)
  wordsEl.innerHTML='';
  const row=document.createElement('div'); row.className='w'; row.id='w_0';
  row.innerHTML = S.current.display.split('').map(ch=>{
    const A = ch.toUpperCase(); const isAZ = /[A-Z]/.test(A);
    return isAZ ? `<span class="circ">${A}</span>` : `<span>${ch}</span>`;
  }).join('');
  wordsEl.appendChild(row);
}

/* =============== selection helpers =============== */
function rcFromIdx(id){ return [(id/S.cols)|0, id%S.cols]; }
function dirOf(a,b){
  const [ar,ac]=rcFromIdx(a), [br,bc]=rcFromIdx(b);
  const dr=Math.sign(br-ar), dc=Math.sign(bc-ac);
  if(dr===0&&dc===0) return null;
  if(dr!==0&&dc!==0 && Math.abs(br-ar)!==Math.abs(bc-ac)) return null;
  return [dr,dc];
}
function cellsBetween(a,b){
  const d=dirOf(a,b); if(!d) return null;
  const [ar,ac]=rcFromIdx(a), [br,bc]=rcFromIdx(b);
  const n=Math.max(Math.abs(br-ar),Math.abs(bc-ac))+1, out=[];
  for(let k=0;k<n;k++){ const r=ar+d[0]*k, c=ac+d[1]*k; out.push(idx(r,c)); } return out;
}
function setSel(on,list){ for(const id of list){ gridEl.children[id]?.classList.toggle('sel',on); } }
function wordFrom(list){ return list.map(i=>S.grid[i]).join(''); }

/* =============== hint (single-cell nudge) =============== */
function showHint(){
  if (S.hintLock) return;
  S.hintLock=true; setTimeout(()=>S.hintLock=false, 2200);
  const p = S.placed[0]; if(!p) return;
  const id = p.path[rand(p.path.length)];
  const cell = gridEl.children[id];
  if (cell){ cell.classList.add('hint'); setTimeout(()=>cell.classList.remove('hint'),1300); }
}
hintBtn.onclick = showHint;

/* =============== finish splash =============== */
function openSplash(){
  $('#spWord').textContent = S.current.display;
  $('#spMeaning').textContent = S.current.meaning || 'Nice solve!';
  const link = $('#spDonate');
  if (S.current.donate){ link.href = S.current.donate; link.classList.remove('hide'); }
  else { link.href='#'; link.classList.add('hide'); }
  $('#splash').style.display='flex';
}
$('#spContinue').onclick = ()=>{
  $('#splash').style.display='none';
  // next puzzle (optional) or just leave it; for now: rebuild with a new skin + word
  startDaily();
};

/* =============== input wiring =============== */
gridEl.addEventListener('pointerdown', e=>{
  const el=e.target.closest('.cell'); if(!el) return;
  S.dragging=true; S.selPath.length=0; S.startIdx=+el.dataset.idx;
  S.selPath=[S.startIdx]; setSel(true,S.selPath);
  gridEl.setPointerCapture?.(e.pointerId); e.preventDefault();
},{passive:false});
gridEl.addEventListener('pointermove', e=>{
  if(!S.dragging) return;
  const el=document.elementFromPoint(e.clientX,e.clientY)?.closest('.cell'); if(!el) return;
  const id=+el.dataset.idx; if(id===S.startIdx) return;
  const seq=cellsBetween(S.startIdx,id); if(!seq) return;
  setSel(false,S.selPath); S.selPath=seq; setSel(true,S.selPath);
  e.preventDefault();
},{passive:false});
addEventListener('pointerup', e=>{
  if(!S.dragging) return; S.dragging=false;
  if(!S.selPath.length) return;
  const fwd=wordFrom(S.selPath), rev=wordFrom([...S.selPath].reverse());
  if (fwd===S.current.target || rev===S.current.target){
    // paint & finish
    const placed=S.placed[0];
    for(const id of placed.path){ const c=gridEl.children[id]; c?.classList.add('found'); c?.classList.remove('sel'); }
    document.getElementById('w_0')?.classList.add('done');
    setTimeout(()=>{
      openSplash(); // show results + donate/meaning
      buzz([8,60,8]);
    }, 240);
  } else {
    buzz([2,40,2]); setSel(false,S.selPath);
  }
  S.selPath.length=0;
});

/* =============== game start =============== */
function startDaily(){
  // rotate skin
  const skin = SKINS[rand(SKINS.length)];
  document.documentElement.style.setProperty('--tile-skin', `url("${skin}")`);

  // pick + normalize word
  const Wraw = WORDS[rand(WORDS.length)];
  S.current = normalizeWord(Wraw);

  // build board sized to word (simple heuristic)
  const L = Math.max(9, Math.min(14, Math.ceil(S.current.target.length * 1.4)));
  S.rows = L; S.cols = L;

  buildEmpty();
  if (!tryPlaceWord(S.current.target)){ startDaily(); return; } // retry new pick if unlucky
  fillRandom(S.current.bag);
  renderGrid(); renderWordList();
  hudTarget.textContent = S.current.display;
  hudTime.textContent = '‚Äî';
  layout();
}

/* =============== settings & start chips =============== */
$('#btnStart').onclick = ()=> { startDaily(); };
$('#btnCfg').onclick = ()=> alert('Daily Roo prototype ‚Äî settings coming soon üòÑ');

/* =============== boot =============== */
startDaily();
</script>
</body>
</html>
